tinymce.PluginManager.add("highlightanalisis", function(a, b) {
    var state;

    /* Actions to do on button click */
    function Klik() {
        state = !state; /* Switching state */
        a.fire('highlightanalisis', {state: state});

        var text = a.selection.getContent({format:'raw'});
        var texttrim = text.replace(/&nbsp;/gi,'').replace(/<br>/gi,'');
        if (texttrim == "") {
            a.insertContent('<div class="hightlight-analisis">&nbsp;</div><p>&nbsp;</p>');
        }else{
            var nodetext = a.selection.getNode();
            var textfix = nodetext.outerHTML;
            if (textfix.replace(/&nbsp;/gi,'').replace(/<br>/gi,'') == '<div class="hightlight-analisis">' + texttrim + '</div>') {
               
                nodetext.remove();
                a.selection.setContent(texttrim);
            }else{
               a.selection.setContent('<div class="hightlight-analisis">' + texttrim + '</div><p>&nbsp;</p>'); 
            }
        };
    }

    function toggleState_highlightanalisis() {
        var self = this;
        a.on('init', function(e) {
            self.active(e.state);
        });
    }

    /* Adding the button & command */
    a.addCommand('cmd_highlightanalisis', Klik);

    a.addButton("highlightanalisis", {
        text: "Highlight Analisis",
        icon: 1,
        // image: b + '/img/hlite.png',
        cmd: 'cmd_highlightanalisis',
        onPostRender: toggleState_highlightanalisis
    }), a.addMenuItem("highlightanalisis", {
        text: "Highlight Analisis",
        icon: 1,
        // image: b + '/img/hlite.png',
        context: "format",
        cmd: 'cmd_highlightanalisis',
        onPostRender: toggleState_highlightanalisis
    })
});